<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyoki Product Pricing Calculator</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="Nyoki-transparent-logo-lrg.png" alt="Nyoki Logo" class="logo">
            <h1>Product Pricing Calculator</h1>
            <button class="settings-icon" onclick="openSettings()" aria-label="Settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.59356 3.94014C9.68397 3.39768 10.1533 3.00009 10.7033 3.00009H13.2972C13.8472 3.00009 14.3165 3.39768 14.4069 3.94014L14.6204 5.22119C14.6828 5.59523 14.9327 5.9068 15.2645 6.09045C15.3387 6.13151 15.412 6.17393 15.4844 6.21766C15.8095 6.41393 16.2048 6.47495 16.5604 6.34175L17.7772 5.88587C18.2922 5.69293 18.8712 5.90061 19.1462 6.37687L20.4432 8.6233C20.7181 9.09957 20.6085 9.70482 20.1839 10.0544L19.1795 10.8812C18.887 11.122 18.742 11.4938 18.7491 11.8726C18.7498 11.915 18.7502 11.9575 18.7502 12.0001C18.7502 12.0427 18.7498 12.0852 18.7491 12.1275C18.742 12.5064 18.887 12.8782 19.1795 13.119L20.1839 13.9458C20.6085 14.2953 20.7181 14.9006 20.4432 15.3769L19.1462 17.6233C18.8712 18.0996 18.2922 18.3072 17.7772 18.1143L16.5604 17.6584C16.2048 17.5252 15.8095 17.5862 15.4844 17.7825C15.412 17.8263 15.3387 17.8687 15.2645 17.9097C14.9327 18.0934 14.6828 18.4049 14.6204 18.779L14.4069 20.06C14.3165 20.6025 13.8472 21.0001 13.2972 21.0001H10.7033C10.1533 21.0001 9.68397 20.6025 9.59356 20.06L9.38005 18.779C9.31771 18.4049 9.06774 18.0934 8.73597 17.9097C8.66179 17.8687 8.58847 17.8263 8.51604 17.7825C8.19101 17.5863 7.79568 17.5252 7.44011 17.6584L6.22325 18.1143C5.70826 18.3072 5.12926 18.0996 4.85429 17.6233L3.55731 15.3769C3.28234 14.9006 3.39199 14.2954 3.81657 13.9458L4.82092 13.119C5.11343 12.8782 5.25843 12.5064 5.25141 12.1276C5.25063 12.0852 5.25023 12.0427 5.25023 12.0001C5.25023 11.9575 5.25063 11.915 5.25141 11.8726C5.25843 11.4938 5.11343 11.122 4.82092 10.8812L3.81657 10.0544C3.39199 9.70484 3.28234 9.09958 3.55731 8.62332L4.85429 6.37688C5.12926 5.90061 5.70825 5.69295 6.22325 5.88588L7.4401 6.34176C7.79566 6.47496 8.19099 6.41394 8.51603 6.21767C8.58846 6.17393 8.66179 6.13151 8.73597 6.09045C9.06774 5.9068 9.31771 5.59523 9.38005 5.22119L9.59356 3.94014Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3432 10.3431 9.00001 12 9.00001C13.6569 9.00001 15 10.3432 15 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>

        <div class="nav-menu">
            <button id="menuToggle" class="menu-icon" aria-label="Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showView('add-edit')">Add/Edit Product</button>
                <button class="nav-btn" onclick="showView('view-products')">View Products</button>
                <button class="nav-btn" onclick="showView('discount-analysis')">Discount Analysis</button>
                <button class="nav-btn" onclick="showView('manage-stock')">Manage Stock</button>
                <button class="nav-btn" onclick="showView('manage-categories')">Manage Categories</button>
                <button class="nav-btn" onclick="showView('manage-marketplaces')">Manage Marketplaces</button>
            </div>
        </div>

        <!-- Add/Edit Product View -->
        <div id="add-edit-view" class="view-section active">
            <div class="main-content">
                <div class="card">
                    <h2>Create New Product</h2>

                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <div class="tooltip">
                            <input type="text" id="productName" placeholder="Enter product name" />
                            <span class="tooltip-text">Enter product name</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="productASIN">Amazon Standard Identification Number</label>
                        <input type="text" id="productASIN" placeholder="ASIN">
                    </div>

                    <div class="form-group">
                        <label for="productCategory">Product Category</label>
                        <select id="productCategory" onchange="ProductManager.handleCategoryChange()">
                            <option value="">No Category</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Marketplaces</label>
                        <div id="marketplaceOptions" class="marketplace-options"></div>
                    </div>

                    <div class="form-group">
                        <label for="productImage">Product Image</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="productImage" accept="image/*">
                            <label for="productImage" class="file-input-label">Choose Image</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="imageLink">Or CDN Image Link</label>
                        <input type="url" id="imageLink" placeholder="https://example.com/image.png">
                    </div>

                    <div class="form-group">
                        <label for="laborCost">Labor Cost (£)</label>
                        <input type="number" id="laborCost" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="overheadCost">Overhead Cost (£)</label>
                        <input type="number" id="overheadCost" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="postCost">Post & Shipping Cost (£)</label>
                        <input type="number" id="postCost" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="packagingCost">Packaging Cost (£)</label>
                        <input type="number" id="packagingCost" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="stockCount">Stock Quantity</label>
                        <input type="number" id="stockCount" step="1" min="0" placeholder="0">
                    </div>

                    <h3 style="color: #6b5b73; margin: 20px 0 15px;">Materials</h3>
                    <div class="form-group">
                        <label for="materialName">Material Name</label>
                        <input type="text" id="materialName" placeholder="e.g., Cotton fabric">
                    </div>

                    <div class="form-group">
                        <label for="materialCost">Material Cost (£)</label>
                        <input type="number" id="materialCost" step="0.01" placeholder="0.00">
                    </div>

                    <button class="btn btn-secondary" onclick="addMaterial()">Add Material</button>

                    <div id="materialsList"></div>

                    <h3 style="color: #6b5b73; margin: 20px 0 15px;">Pricing</h3>
                    <div class="form-group">
                        <label for="marginPercent">Desired Margin (%)</label>
                        <input type="number" id="marginPercent" placeholder="50" min="0" max="1000">
                    </div>

                    <div class="form-group">
                        <label for="retailPrice">Or Set Retail Price (£)</label>
                        <input type="number" id="retailPrice" step="0.01" placeholder="0.00">
                    </div>

                    <div style="margin-top: 30px;">
                        <button class="btn" onclick="saveProduct()">Save Product</button>
                        <button class="btn btn-secondary" onclick="showView('view-products')" style="margin-left: 10px;">View All Products</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Cost Breakdown</h2>
                    <div id="costBreakdown">
                        <p style="text-align: center; color: #999; font-style: italic;">Add materials to see cost breakdown</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Products View -->
        <div id="view-products-view" class="view-section">
            <div class="card">
                <h2>Your Products</h2>
                <div class="filter-bar" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; gap:10px;">
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="searchInput" placeholder="Search products..." oninput="searchAndFilterProducts()" style="padding: 8px; border: 2px solid #e8ddd4; border-radius: 6px;">
                        <select id="filterByCategory" onchange="searchAndFilterProducts()" style="padding: 8px; border: 2px solid #e8ddd4; border-radius: 6px;">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn" style="padding: 8px 25px; min-width: 130px; white-space: nowrap;" onclick="exportProducts()">Export CSV</button>
                        <button class="btn btn-secondary" style="padding: 8px 25px; min-width: 130px; white-space: nowrap;" onclick="importProducts()">Import CSV</button>
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCSVFile(event)">
                    </div>
                </div>
                <div id="productsList" class="product-grid">
                    <p style="text-align: center; color: #999; font-style: italic; grid-column: 1/-1;">No products created yet</p>
                </div>
            </div>
        </div>

        <!-- Manage Categories View -->
        <div id="manage-categories-view" class="view-section">
            <div class="main-content">
                <div class="card">
                    <h2>Create New Category</h2>
                    <div class="form-group">
                        <label for="categoryName">Category Name</label>
                        <input type="text" id="categoryName" placeholder="Enter category name">
                    </div>

                    <div class="form-group">
                        <label for="categoryDescription">Description (Optional)</label>
                        <textarea id="categoryDescription" placeholder="Describe this product category" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="categoryColor">Category Color</label>
                        <input type="color" id="categoryColor" value="#6b5b73">
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label"><input type="checkbox" id="categoryHasVAT" onchange="document.getElementById('categoryVATPercent').style.display=this.checked?'block':'none';"> Items in this category have VAT</label>
                        <input type="number" id="categoryVATPercent" placeholder="VAT %" step="0.01" style="display:none; margin-top:5px;">
                    </div>

                    <h3 style="color:#6b5b73; margin:20px 0 15px;">Materials</h3>
                    <div class="form-group">
                        <label for="categoryMaterialName">Material Name</label>
                        <input type="text" id="categoryMaterialName" placeholder="e.g., Cotton fabric">
                    </div>

                    <div class="form-group">
                        <label for="categoryMaterialCost">Material Cost (£)</label>
                        <input type="number" id="categoryMaterialCost" step="0.01" placeholder="0.00">
                    </div>
                    <button class="btn btn-secondary" onclick="ProductManager.addCategoryMaterial()">Add Material</button>
                    <div id="categoryMaterialsList"></div>

                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="btn" onclick="saveCategory()">Save Category</button>
                        <button class="btn btn-secondary" onclick="importCategories()">Import Categories</button>
                        <input type="file" id="categoryCSVInput" accept=".csv" style="display:none;" onchange="handleCategoryCSVFile(event)">
                    </div>
                </div>

                <div class="card">
                    <h2>Existing Categories</h2>
                    <div id="categoriesList">
                        <p style="text-align: center; color: #999; font-style: italic;">No categories created yet</p>
                    </div>
                    <button class="btn" onclick="exportCategories()" style="margin-top:10px;">Export Categories</button>
                </div>
            </div>
        </div>

        <!-- Manage Marketplaces View -->
        <div id="manage-marketplaces-view" class="view-section">
            <div class="main-content">
                <div class="card">
                    <h2>Create New Marketplace</h2>
                    <div class="form-group">
                        <label for="marketplaceName">Marketplace Name</label>
                        <input type="text" id="marketplaceName" placeholder="Enter marketplace name">
                    </div>
                    <div class="form-group">
                        <label for="marketplacePercent">Charge Percentage (%)</label>
                        <input type="number" id="marketplacePercent" step="0.01" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="marketplaceFixed">Fixed Charge (£)</label>
                        <input type="number" id="marketplaceFixed" step="0.01" placeholder="0.00">
                    </div>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="btn" onclick="saveMarketplace()">Save Marketplace</button>
                        <button class="btn btn-secondary" onclick="importMarketplaces()">Import Marketplaces</button>
                        <input type="file" id="marketplaceCSVInput" accept=".csv" style="display:none;" onchange="handleMarketplaceCSVFile(event)">
                    </div>
                </div>

                <div class="card">
                    <h2>Existing Marketplaces</h2>
                    <div id="marketplacesList">
                        <p style="text-align: center; color: #999; font-style: italic;">No marketplaces created yet</p>
                    </div>
                    <button class="btn" onclick="exportMarketplaces()" style="margin-top:10px;">Export Marketplaces</button>
                </div>
            </div>
        </div>


        <!-- Discount Analysis View -->
        <div id="discount-analysis-view" class="view-section">
            <div class="card">
                <h2>Discount Analysis</h2>
                <div id="discountTabs" class="discount-tabs"></div>
                <div class="filter-bar" style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" id="analysisSearch" placeholder="Search products..." style="padding:8px; border:2px solid #e8ddd4; border-radius:6px;">
                    <select id="analysisCategory" style="padding:8px; border:2px solid #e8ddd4; border-radius:6px;">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <table class="discount-table">
                    <thead>
                        <tr>
                            <th>Thumb</th>
                            <th>Product</th>
                            <th>View</th>
                            <th>Retail Price</th>
                            <th>Profit</th>
                            <th>Margin %</th>
                            <th class="disc10">10% Off</th>
                            <th class="disc20">20% Off</th>
                            <th class="disc30">30% Off</th>
                            <th class="disc40">40% Off</th>
                            <th class="disc50">50% Off</th>
                        </tr>
                    </thead>
                    <tbody id="discountTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Manage Stock View -->
        <div id="manage-stock-view" class="view-section">
            <div class="card">
                <h2>Manage Stock</h2>
                <div class="filter-bar" style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" id="stockSearch" placeholder="Search products..." style="padding:8px; border:2px solid #e8ddd4; border-radius:6px;">
                    <select id="stockCategory" style="padding:8px; border:2px solid #e8ddd4; border-radius:6px;">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <table class="manage-stock-table">
                    <thead>
                        <tr>
                            <th>Thumbnail</th>
                            <th>Product</th>
                            <th>Stock Quantity</th>
                        </tr>
                    </thead>
                    <tbody id="manageStockBody"></tbody>
                </table>
                <div class="save-actions">
                    <button class="btn" style="margin-top:15px;" onclick="ManageStock.save()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/popup.js"></script>
    <script src="js/themeManager.js"></script>
    <script src="js/productManager.js"></script>
    <script src="js/discountAnalysis.js"></script>
    <script src="js/postPackaging.js"></script>
    <script src="js/manageStock.js"></script>
    <script src="js/menuManager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
